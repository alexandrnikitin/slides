<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						<h3>High-performance .NET by example:</h3>
						<h4>Filtering bot traffic</h4>
						<br/>
						<p>NET Meetup #22 Minsk 2017</p>
						<p>
							<small>by <a href="https://twitter.com/nikitin_a_a">Alexandr Nikitin</a></small>
						</p>
					</section>
					<section>
						<h2>About me:</h2>
						<p>Software Engineer @Adform</p>
						<p>@nikitin_a_a</p>
						<p>https://github.com/alexandrnikitin/</p>
						<p>https://alexandrnikitin.github.io/blog/</p>
					</section>

					<section>
						<h2>Overview</h2>
						<ul>
							<li>Domain</li>
							<li>Measure, measure, measure!</li>
							<li>Algorithm</li>
							<li>Tools</li>
							<li>Performance optimizations</li>
						</ul>
					</section>
				</section>

				<section>
                    <section><h2>Domain</h2></section>
                    <section data-background="img/about-adform.png" data-background-size="60%"></section>
                    <section><h2>All websites receive bot traffic!</h2></section>
					<section data-background="img/incapsula.png" data-background-size="75%"></section>
					<section data-background="img/solve-media.png" data-background-size="70%"></section>
                    <section>
                        <h2>The bot classification</h2>
                        <ul>
							<li><u>White bots (good)</u> - search engine bots like Google, Bing or DuckDuckGo.</li>
                            <li><u>Grey bots (neutral)</u> - feed fetchers, website crawlers and data scrappers.</li>
                            <li><u>Black bots (harmful)</u> - fraud and criminal activity, intentional impersonation for profit.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Ways to identify:</h2>
                        <ul>
                            <li>Technical info</li>
                            <li>Behavior analysis</li>
                            <li>Honeypots</li>
                        </ul>
                    </section>

                    <section>
                        Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36
                    </section>

                    <section>
                        Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)
                    </section>

                    <section>
                        <h3>The Interactive Advertising Bureau (IAB)</h3>

						<ul>
							<li>advertising business organization</li>
							<li>develops industry standards</li>
							<br/>
							<li>Do Not Track and Internet Explorer</li>
							<li>3rd party cookies in Firefox</li>
							<li>Adblock Plus and IAB summit</li>
						</ul>
                    </section>

					<section>
						<h3>IAB International Spiders and Bots List</h3>
						<div class="fragment"><pre><code data-trim contenteditable>
Pricing:
IAB General Member: $4 000
IAB Associate Member: $7 000
Non-Member: $14 000
						</code></pre></div>
						<div class="fragment">The list “is required for compliance to the IAB’s Client Side Counting (CSC) Measurement Guidelines”</div>
					</section>

					<section>
						<h3>Simplified content</h3>
						<div style="font-size: 200%; width: 200%; margin-left: -25%">
							<pre><code class="cs" data-trim contenteditable>
googlebot
bingbot
twitterbot
duckduckbot
curl
						</code></pre></div>
					</section>

                </section>

			<section>
				<section>
					<h2>Measure, measure, measure!</h2>
					<blockquote>&ldquo;If you can not measure it, you can not improve it.&rdquo;</blockquote>
					<p style="text-align: right;">Lord Kelvin</p>
				</section>
				<section>
					Measurement is hard!
				</section>
				<section>
					<h4>Microbenchmarking DOs DON’Ts from Microsoft:</h4>
					<div style="font-size: 80%;"><ul>
						<li>DO use a microbenchmark when you have an isolated piece of code whose performance you want to analyze.</li>
						<li>DO NOT use a microbenchmark for code that has non-deterministic dependences (e.g. network calls, file I/O etc.)</li>
						<li>DO run all performance testing against retail optimized builds.</li>
						<li>DO run many iterations of the code in question to filter out noise.</li>
						<li>DO minimize the effects of other applications on the performance of the microbenchmark by closing as many unnecessary applications as possible.</li>
					</ul></div>
				</section>
				<section>
					<h4>Development pipeline:</h4>
						<div class="fragment" align="left">A feature -> C# code</div>
						<div class="fragment" align="left">C# code + Compiler -> IL assembly</div>
						<div class="fragment" align="left">IL assembly + BCL + 3rdParty libs -> Application</div>
						<div class="fragment" align="left">Application + CLR -> ASM</div>
						<div class="fragment" align="left">ASM + CPU -> Result</div>
				</section>
				<section>
					<h4>Variety of implementations:</h4>
					<div class="fragment" align="left">C# Compilers: Legacy, Roslyn, Mono</div>
					<div class="fragment" align="left">IL Compilation: JIT, NGen, MPGO, .NET Native, LLVM</div>
					<div class="fragment" align="left">JITs: Legacy x86/ x64, RyuJIT, Mono</div>
					<div class="fragment" align="left">CLRs: CLR2, CLR4, CoreCLR, Mono</div>
					<div class="fragment" align="left">GCs: Microsoft GC (few modes), Boehm, Sgen</div>
					<div class="fragment" align="left">OSes: Windows, Linux, OS X</div>
					<div class="fragment" align="left">Hardware: ...</div>
				</section>
			</section>

			<section>
				<section>
						<h2>Algorithm</h2>
				</section>

				<section>
					<h4>Multiple string/ pattern matching problem</h4>
					<ul>
						<li>anti-virus software</li>
						<li>network security</li>
						<li>biology and DNA</li>
						<li>spam detection</li>
						<li>plagiarism detection</li>
					</ul>
				</section>

				<section data-background="img/banners.jpg" data-background-size="80%"></section>

				<section>
					<h4>String searching algorithms:</h4>
					<ul>
						<li>Naive</li>
						<li>Finite-state automaton</li>
						<li>Aho–Corasick</li>
						<li>Boyer-Moore & Commentz-Walter</li>
						<li>Backward Oracle Matching & Set-BOM</li>
						<li>Rabin–Karp</li>
					</ul>
				</section>

				<section>
					<h4>Key features of the Aho–Corasick algorithm:</h4>
					<ul>
						<li>a pattern matching algorithm</li>
						<li>accepts a finite set of patterns</li>
						<li>matches all patterns simultaneously</li>
						<li>backed by a Trie</li>
						<li>“failure” links between nodes</li>
					</ul>
				</section>

				<section data-background="img/ahocorasick.png" data-background-size="70%"></section>

				<section>
					<p>An animated version</p>
					<p>http://blog.ivank.net/aho-corasick-algorithm-in-as3.html</p>
				</section>

			</section>

			<section>
				<section>
						<h2>Tools</h2>
				</section>

				<section>
					<h4>BenchmarkDotNet</h4>
					<a href="http://benchmarkdotnet.org/">http://benchmarkdotnet.org/</a>
					<img src="img/benchmarkdotnet.png" alt="benchmarkdotnet">
					<p>Alternatives: xunit.performance, NBench</p>
				</section>

				<section>
					<h4>ILSpy</h4>
					<a href="https://github.com/icsharpcode/ILSpy">https://github.com/icsharpcode/ILSpy</a>
					<img src="img/ilspy.png" alt="ilspy">
					<p>Alternatives: ildasm, dotPeek, Just Decompile, dnSpy</p>
				</section>

				<section>
					<h4>PerfView</h4>
					<a href="https://github.com/Microsoft/perfview">https://github.com/Microsoft/perfview</a>
					<img src="img/perfview.png" alt="perfview">
				</section>

				<section>
					<h4>WinDbg</h4>
					<a href="http://www.windbg.org/">http://www.windbg.org/</a>
					<img src="img/windbg.png" alt="windbg">
					<p><a href="https://docs.google.com/document/d/1yMQ8NAQZEBtsfVp7AsFLSA_MkIKlYNuSowG72_nU0ek">“Debugging .NET with WinDbg” by Sebastian Solnica</a></p>
				</section>

				<section>
					<h4>Intel VTune Amplifier</h4>
					<a href="https://software.intel.com/en-us/intel-vtune-amplifier-xe">https://software.intel.com/en-us/intel-vtune-amplifier-xe</a>
					<img src="img/intel-vtune.png" alt="intel-vtune">
				</section>


			</section>

			<section>
				<section>
						<h2>Performance optimizations</h2>
				</section>

				<section>
					the code
				</section>

				<section>
					Measurement
				</section>

				<section>
					APIs of Libraries
				</section>

				<section>
					CLR internals
				</section>

				<section>
					BCL Data Structures
				</section>

				<section>
					How CPU works
				</section>

				<section>
					<pre><code data-trim contenteditable>
Caches:
Cache line = 64 bytes
L1 Data cache = 32 KB
L1 Instruction cache = 32 KB
L2 cache = 256 KB
L3 cache = 8 MB

Latency:
L1 Data Cache Latency = 4 cycles for simple access via pointer
L1 Data Cache Latency = 5 cycles for access with complex address calculation
L2 Cache Latency = 12 cycles
L3 Cache Latency = 36 cycles
RAM Latency = 36 cycles + 57 ns
                   </code></pre>
				</section>

				<section>
					Front-end and the Back-end
				</section>

				<section>
					Maximum IPC (instructions per cycle)
				</section>

				<section>
					Advanced data structures
				</section>

				<section>
					Hacks
				</section>

				<section>
					A HUGE mistake
				</section>

				<section>
					String traversal
				</section>

			</section>

				<section>
					Summary
				</section>

				<section>
					What's next?
					compacting the data structure
					perfect hash
					ASCII -> bit masks
					SIMD (Single instruction, multiple data)
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
